
# Serviceì™€ Networking

## Serviceê°€ ì™œ í•„ìš”í•œê°€?

### ë¬¸ì œ ìƒí™©
```
ğŸ˜° Podì˜ ë¬¸ì œì :
- Pod IPëŠ” ì¬ì‹œì‘í•  ë•Œë§ˆë‹¤ ë°”ë€œ (203.0.113.1 â†’ 203.0.113.5)
- ì—¬ëŸ¬ ê°œì˜ Pod ì¤‘ ì–´ë””ë¡œ ì ‘ì†í•´ì•¼ í• ì§€ ëª¨ë¦„
- ì™¸ë¶€ì—ì„œ Podì— ì§ì ‘ ì ‘ê·¼í•˜ê¸° ì–´ë ¤ì›€
```

### Serviceì˜ í•´ê²°ì±…
```
ğŸ˜Š Serviceì˜ ì—­í• :
- ê³ ì •ëœ IP ì£¼ì†Œì™€ DNS ì´ë¦„ ì œê³µ
- ì—¬ëŸ¬ Podì— íŠ¸ë˜í”½ì„ ìë™ìœ¼ë¡œ ë¶„ë°°
- ì™¸ë¶€ì—ì„œ ì•ˆì „í•˜ê²Œ ì ‘ê·¼í•  ìˆ˜ ìˆëŠ” í†µë¡œ ì œê³µ
```

## Service íƒ€ì…ë³„ ì‰¬ìš´ ì„¤ëª…

### 1. ClusterIP (ê¸°ë³¸ê°’)
**ë¹„ìœ **: íšŒì‚¬ ë‚´ë¶€ ì „í™”ë²ˆí˜¸
- **ìš©ë„**: í´ëŸ¬ìŠ¤í„° **ë‚´ë¶€ì—ì„œë§Œ** ì ‘ê·¼ ê°€ëŠ¥
- **ì˜ˆì‹œ**: ì›¹ ì„œë²„ê°€ ë°ì´í„°ë² ì´ìŠ¤ì— ì ‘ê·¼í•  ë•Œ
- **íŠ¹ì§•**: ê°€ì¥ ì•ˆì „í•˜ê³  ê¸°ë³¸ì ì¸ ë°©ì‹

```yaml
apiVersion: v1
kind: Service
metadata:
  name: database-service
spec:
  type: ClusterIP  # ìƒëµ ê°€ëŠ¥ (ê¸°ë³¸ê°’)
  selector:
    app: database
  ports:
  - port: 3306
    targetPort: 3306
```

### 2. NodePort
**ë¹„ìœ **: ê±´ë¬¼ ì…êµ¬ì˜ íŠ¹ì • ë¬¸ ë²ˆí˜¸
- **ìš©ë„**: ì™¸ë¶€ì—ì„œ **ë…¸ë“œì˜ íŠ¹ì • í¬íŠ¸**ë¡œ ì ‘ê·¼
- **ì˜ˆì‹œ**: ê°œë°œ ì¤‘ì¸ ì›¹ ì‚¬ì´íŠ¸ë¥¼ ì™¸ë¶€ì—ì„œ í…ŒìŠ¤íŠ¸
- **íŠ¹ì§•**: 30000-32767 ë²”ìœ„ì˜ í¬íŠ¸ ì‚¬ìš©

```yaml
apiVersion: v1
kind: Service
metadata:
  name: web-nodeport
spec:
  type: NodePort
  selector:
    app: web
  ports:
  - port: 80
    targetPort: 80
    nodePort: 30080  # ì™¸ë¶€ì—ì„œ ì ‘ê·¼í•  í¬íŠ¸
```

### 3. LoadBalancer
**ë¹„ìœ **: í˜¸í…” í”„ëŸ°íŠ¸ ë°ìŠ¤í¬ (ì™¸ë¶€ ì†ë‹˜ì„ ì ì ˆí•œ ë°©ìœ¼ë¡œ ì•ˆë‚´)
- **ìš©ë„**: **ì™¸ë¶€ ë¡œë“œë°¸ëŸ°ì„œ**ë¥¼ í†µí•œ ì ‘ê·¼
- **ì˜ˆì‹œ**: ì‹¤ì œ ì„œë¹„ìŠ¤ë¥¼ ì¸í„°ë„·ì— ì˜¤í”ˆí•  ë•Œ
- **íŠ¹ì§•**: í´ë¼ìš°ë“œ í™˜ê²½ì—ì„œ ìë™ìœ¼ë¡œ ë¡œë“œë°¸ëŸ°ì„œ ìƒì„±

```yaml
apiVersion: v1
kind: Service
metadata:
  name: web-loadbalancer
spec:
  type: LoadBalancer
  selector:
    app: web
  ports:
  - port: 80
    targetPort: 80
```

### 4. ExternalName
**ë¹„ìœ **: ì „í™”ë²ˆí˜¸ë¶€ì˜ ë‹¨ì¶•ë²ˆí˜¸
- **ìš©ë„**: ì™¸ë¶€ ì„œë¹„ìŠ¤ì— **ë³„ëª…**ì„ ë¶™ì—¬ì„œ ì‚¬ìš©
- **ì˜ˆì‹œ**: `google.com`ì„ `search-engine`ì´ë¼ëŠ” ì´ë¦„ìœ¼ë¡œ ì‚¬ìš©
- **íŠ¹ì§•**: DNS CNAME ë ˆì½”ë“œë¥¼ ìƒì„±

## ì‹¤ì œ ì‚¬ìš© ì‹œë‚˜ë¦¬ì˜¤

### ì‹œë‚˜ë¦¬ì˜¤ 1: ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ êµ¬ì¡°
```mermaid
graph TD
    A[ì™¸ë¶€ ì‚¬ìš©ì] --> B[LoadBalancer Service]
    B --> C[Web Pod 1]
    B --> D[Web Pod 2]
    C --> E[ClusterIP Service]
    D --> E
    E --> F[Database Pod]
```

**ì„¤ëª…**:
- ì™¸ë¶€ ì‚¬ìš©ìëŠ” LoadBalancerë¥¼ í†µí•´ ì ‘ê·¼
- ì›¹ ì„œë²„ë“¤ì€ ClusterIPë¥¼ í†µí•´ ë°ì´í„°ë² ì´ìŠ¤ ì ‘ê·¼

### ì‹œë‚˜ë¦¬ì˜¤ 2: ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ êµ¬ì¡°
```
ğŸ¬ ì˜¨ë¼ì¸ ì‡¼í•‘ëª°:
â”œâ”€â”€ Frontend Service (LoadBalancer) â† ì™¸ë¶€ ì ‘ê·¼
â”œâ”€â”€ User Service (ClusterIP) â† ë‚´ë¶€ ì „ìš©
â”œâ”€â”€ Order Service (ClusterIP) â† ë‚´ë¶€ ì „ìš©
â””â”€â”€ Payment Service (ClusterIP) â† ë‚´ë¶€ ì „ìš©
```

## ì‹¤ìŠµ: Service ë§Œë“¤ì–´ë³´ê¸°

### 1. ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ Pod ìƒì„±
```bash
# nginx Pod 3ê°œ ìƒì„± (Deployment ì‚¬ìš©)
kubectl create deployment web-app --image=nginx --replicas=3
```

### 2. ClusterIP Service ìƒì„±
```bash
# ClusterIP ì„œë¹„ìŠ¤ ìƒì„±
kubectl expose deployment web-app --port=80 --type=ClusterIP
```

### 3. Service í™•ì¸
```bash
# ì„œë¹„ìŠ¤ ëª©ë¡ ë³´ê¸°
kubectl get services

# ì„œë¹„ìŠ¤ ìƒì„¸ ì •ë³´
kubectl describe service web-app
```

### 4. NodePort Service ìƒì„±
```bash
# NodePort ì„œë¹„ìŠ¤ ìƒì„±
kubectl expose deployment web-app --port=80 --type=NodePort --name=web-nodeport
```

### 5. ì ‘ê·¼ í…ŒìŠ¤íŠ¸
```bash
# í´ëŸ¬ìŠ¤í„° ë‚´ë¶€ì—ì„œ í…ŒìŠ¤íŠ¸
kubectl run test-pod --image=busybox --rm -it -- wget -qO- web-app

# NodePortë¡œ ì™¸ë¶€ì—ì„œ í…ŒìŠ¤íŠ¸ (minikubeì˜ ê²½ìš°)
minikube service web-nodeport --url
```

## DNSì™€ Service Discovery

### ìë™ DNS ìƒì„±
KubernetesëŠ” Serviceë§ˆë‹¤ **ìë™ìœ¼ë¡œ DNS ì´ë¦„**ì„ ìƒì„±í•©ë‹ˆë‹¤:

```bash
# í˜•ì‹: service-name.namespace.svc.cluster.local
web-app.default.svc.cluster.local

# ê°™ì€ ë„¤ì„ìŠ¤í˜ì´ìŠ¤ì—ì„œëŠ” ì„œë¹„ìŠ¤ ì´ë¦„ë§Œìœ¼ë¡œë„ ì ‘ê·¼ ê°€ëŠ¥
curl http://web-app/
```

### í™˜ê²½ ë³€ìˆ˜ ìë™ ìƒì„±
```bash
# Serviceê°€ ìƒì„±ë˜ë©´ ê´€ë ¨ í™˜ê²½ ë³€ìˆ˜ë„ ìë™ ìƒì„±
WEB_APP_SERVICE_HOST=10.96.0.1
WEB_APP_SERVICE_PORT=80
```

## ë„¤íŠ¸ì›Œí‚¹ ì‹¬í™” ê°œë…

### 1. Endpoint
- Serviceê°€ íŠ¸ë˜í”½ì„ ì „ë‹¬í•  **ì‹¤ì œ Podë“¤ì˜ IP ëª©ë¡**
- Podê°€ ì¶”ê°€/ì‚­ì œë˜ë©´ ìë™ìœ¼ë¡œ ì—…ë°ì´íŠ¸

```bash
# Endpoint í™•ì¸
kubectl get endpoints web-app
```

### 2. Session Affinity
- ê°™ì€ ì‚¬ìš©ìì˜ ìš”ì²­ì„ **ê°™ì€ Pod**ë¡œ ë³´ë‚´ëŠ” ê¸°ëŠ¥
- ë¡œê·¸ì¸ ìƒíƒœ ìœ ì§€ê°€ í•„ìš”í•œ ê²½ìš° ì‚¬ìš©

```yaml
spec:
  sessionAffinity: ClientIP  # ê°™ì€ IPëŠ” ê°™ì€ Podë¡œ
```

### 3. Service Port vs Target Port
```yaml
ports:
- port: 80         # Serviceê°€ ë°›ëŠ” í¬íŠ¸
  targetPort: 8080 # Podê°€ ì‹¤ì œ ì‚¬ìš©í•˜ëŠ” í¬íŠ¸
```

## ë¬¸ì œ í•´ê²° íŒ

### Serviceê°€ ì ‘ê·¼ë˜ì§€ ì•Šì„ ë•Œ
```bash
# 1. Service ìƒíƒœ í™•ì¸
kubectl get service web-app

# 2. Endpoint í™•ì¸ (Podê°€ ì—°ê²°ë˜ì–´ ìˆëŠ”ì§€)
kubectl get endpoints web-app

# 3. Podì˜ ë¼ë²¨ í™•ì¸
kubectl get pods --show-labels

# 4. Serviceì˜ selector í™•ì¸
kubectl describe service web-app
```

### ì¼ë°˜ì ì¸ ë¬¸ì œë“¤
- **Selector ë¶ˆì¼ì¹˜**: Serviceì˜ selectorì™€ Podì˜ labelì´ ë‹¤ë¦„
- **Port ë¶ˆì¼ì¹˜**: targetPortì™€ Podì˜ ì‹¤ì œ í¬íŠ¸ê°€ ë‹¤ë¦„
- **Pod ì¤€ë¹„ ì•ˆë¨**: Podê°€ ì•„ì§ Ready ìƒíƒœê°€ ì•„ë‹˜

## ë‹¤ìŒ ë‹¨ê³„
Serviceë¡œ ë„¤íŠ¸ì›Œí‚¹ì„ ì´í•´í–ˆë‹¤ë©´ [[Deploymentì™€ ReplicaSet]]ì„ í†µí•´ Podë¥¼ ì•ˆì •ì ìœ¼ë¡œ ê´€ë¦¬í•˜ëŠ” ë°©ë²•ì„ ì•Œì•„ë³´ì„¸ìš”!

#Kubernetes #Service #Networking
